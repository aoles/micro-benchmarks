---
title: "microbenchmark-snippets"
author: "Andrzej Ole≈õ"
output: 
  md_document:
    toc: true
---

```{r microbenchmark, echo=FALSE}
library(microbenchmark)

options(width=100L)
```

## `data.frame` column names {#dataframe-column-names}

Use `names` not `colnames` to access column names in `data.frames`.

```{r data.frame}
microbenchmark(names(mtcars), colnames(mtcars))
identical(names(mtcars), colnames(mtcars))
```

Or even better, use the list representation:

```{r data.frame-list}
list = as.list(mtcars)
microbenchmark(names(list), names(mtcars))
identical(names(list), names(mtcars))
```

## Add elements to list

Use double brackets when adding/setting elements of list.

```{r set-list-el}
list = list()
microbenchmark({list["a"] = 1}, {list[["a"]] = 1})
```

## Coerce result of `strsplit` to a vector

Take the first element of the list rather than unlisting.

```{r strsplit}
x = paste(letters[1:3], collapse = ", ")

microbenchmark(
  unlist(strsplit(x, ", ", fixed=TRUE)),
  strsplit(x, ", ", fixed=TRUE)[[1L]]
)
```

## `sprintf` vs `paste`

`sprintf` can be almost 2x faster~

```{r sprintf}
ext = "pdf"

microbenchmark(
    paste(".*\\.", ext, "$", sep=""),
    paste0(".*\\.", ext, "$"),
    sprintf(".*\\.%s$", ext)
)
```

## `sapply(..., USE.NAMES=FALSE)` vs. `unlist(lapply(...))`

```{r sapply_lapply}
x = letters
microbenchmark(
  sapply(x, nchar, USE.NAMES=FALSE),
  unlist(lapply(x, nchar))
)
```

## Interleaving two vectors

```{r interleave}
length = 10
a <- letters[1:length]
b <- LETTERS[1:length]

microbenchmark(
  unlist(mapply(function(x, y) c(x, y), a, b, SIMPLIFY=FALSE, USE.NAMES=FALSE)),
  c(rbind(a, b)),
  {
    v = vector(mode = "character", length = 2*length)
    idx <- 2*1:10
    v[idx-1] = a
    v[idx] = b
  },
  {
    idx <- order(c(seq_along(a), seq_along(b)))
    c(a,b)[idx]
  }
)
```

## Session info

```{r sessionInfo}
sessionInfo()
```
